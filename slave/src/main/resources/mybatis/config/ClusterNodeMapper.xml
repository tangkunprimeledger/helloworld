<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.higgs.trust.slave.dao.config.ClusterNodeDao">

    <insert id="insertClusterNode" parameterType="com.higgs.trust.slave.dao.po.config.ClusterNodePO">
		INSERT INTO cluster_node(node_name,
				p2p_status,
				rs_status,
				create_time,
				update_time)
		VALUES (#{nodeName},
		#{p2pStatus},
		#{rsStatus},
		now(3),
		now(3))
	</insert>


    <update id="updateClusterNode" parameterType="com.higgs.trust.slave.dao.po.config.ClusterNodePO">
        UPDATE cluster_node SET
        update_time=now(3),
        <if test="p2pStatus != null and p2pStatus!=''">
            p2p_status=#{p2pStatus},
        </if>
        <if test="rsStatus != null and rsStatus!=''">
            rs_status=#{rsStatus}
        </if>
        WHERE `node_name`=#{nodeName}
    </update>


    <select id="getClusterNode" parameterType="java.lang.String"
            resultType="com.higgs.trust.slave.dao.po.config.ClusterNodePO">
		SELECT    node_name as nodeName,
								p2p_status as p2pStatus,
								rs_status as rsStatus,
								create_time as createTime,
								update_time as updateTime
		      FROM cluster_node WHERE `node_name`=#{nodeName}
	</select>

    <select id="getNodeNum" resultType="java.lang.Integer">
		SELECT count(1) from cluster_node WHERE `p2p_status`='TRUE'
	</select>

</mapper>
